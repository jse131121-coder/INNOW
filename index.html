<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roleplay Community</title>

<style>
body{margin:0;font-family:Arial;background:#f3f3f3}

header{padding:10px;background:white;border-bottom:1px solid #ddd;font-weight:bold}

.roomList{
width:200px;
background:white;
position:fixed;
top:0;
bottom:0;
border-right:1px solid #ddd;
overflow:auto;
}

.roomBtn{display:block;padding:12px;border-bottom:1px solid #eee;cursor:pointer}

.main{
margin-left:200px;
display:flex;
flex-direction:column;
height:100vh;
}

.notice{background:#fff3b0;padding:8px;text-align:center}

.topUsers{padding:8px;background:white;border-bottom:1px solid #ddd}

.chat{flex:1;overflow:auto;padding:20px}

.msg{display:flex;margin-bottom:16px}
.msg.me{justify-content:flex-end}
.msg img{width:36px;height:36px;border-radius:50%;margin-right:8px}

.bubble{background:#efddea;padding:10px 14px;border-radius:14px;max-width:60%;white-space:pre-line}
.me .bubble{background:#f5eac7}

.msgImgs img{width:120px;margin-top:6px;border-radius:8px}

.inputBox{display:flex;padding:10px;background:white;border-top:1px solid #ddd}
textarea{flex:1;height:45px}
</style>
</head>

<body>

<div class="roomList" id="roomList"></div>

<div class="main">
<header id="roomTitle">Room</header>
<div class="notice" id="notice">공지 없음</div>
<div class="topUsers" id="userBar"></div>
<div class="chat" id="chat"></div>

<div class="inputBox">
<textarea id="msgInput"></textarea>
<input type="file" id="imgInput" multiple>
<button onclick="sendMsg()">전송</button>
</div>
</div>

<script>
const users={
SEORIN:{img:"https://i.pravatar.cc/100?img=1"},
HARI:{img:"https://i.pravatar.cc/100?img=2"},
ROSSY:{img:"https://i.pravatar.cc/100?img=3"},
DANA:{img:"https://i.pravatar.cc/100?img=4"}
}

let rooms=JSON.parse(localStorage.getItem("rooms")||"{}")

if(Object.keys(rooms).length===0){
rooms={
"room1":{title:"One and Only",notice:"공지 없음",messages:[]},
"room2":{title:"Second Room",notice:"공지 없음",messages:[]}
}
}

let currentRoom="room1"
let currentUser="SEORIN"

function save(){
localStorage.setItem("rooms",JSON.stringify(rooms))
}

function renderRooms(){
const el=document.getElementById("roomList")
el.innerHTML=""
Object.keys(rooms).forEach(r=>{
el.innerHTML+=`<div class="roomBtn" onclick="openRoom('${r}')">${rooms[r].title}</div>`
})
}
renderRooms()

function openRoom(r){
currentRoom=r
document.getElementById("roomTitle").innerText=rooms[r].title
document.getElementById("notice").innerText=rooms[r].notice
renderChat()
}

function renderUsers(){
const bar=document.getElementById("userBar")
bar.innerHTML=""
Object.keys(users).forEach(u=>{
bar.innerHTML+=`<button onclick="switchUser('${u}')">${u}</button>`
})
}
renderUsers()

function switchUser(u){
currentUser=u
}

function renderChat(){
const chat=document.getElementById("chat")
chat.innerHTML=""

rooms[currentRoom].messages.forEach(m=>{
const me=(m.user===currentUser)?"msg me":"msg"
let imgs=""
if(m.images){
imgs='<div class="msgImgs">'
m.images.forEach(i=>imgs+=`<img src="${i}">`)
imgs+='</div>'
}

chat.innerHTML+=`
<div class="${me}">
<img src="${users[m.user].img}">
<div class="bubble">${m.text||""}${imgs}</div>
</div>
`
})
}

function sendMsg(){
const text=document.getElementById("msgInput").value
const files=document.getElementById("imgInput").files
let imgs=[]
for(let f of files){
imgs.push(URL.createObjectURL(f))
}

rooms[currentRoom].messages.push({
user:currentUser,
text:text,
images:imgs
})

save()
renderChat()

document.getElementById("msgInput").value=""
document.getElementById("imgInput").value=""
}

/* Enter 전송 */
document.getElementById("msgInput").addEventListener("keydown",function(e){
if(e.key==="Enter"&&!e.shiftKey){
e.preventDefault()
sendMsg()
}
})

openRoom(currentRoom)
</script>

</body>
</html>

